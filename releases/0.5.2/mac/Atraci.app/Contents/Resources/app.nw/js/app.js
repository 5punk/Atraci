var Settings;Settings={get:function(a){return localStorage["settings_"+a]},set:function(a,b){return localStorage.setItem("settings_"+a,b)},init:function(){return this.get("updateUrl")?void 0:this.set("updateUrl","http://getatraci.net/update.json")}},Settings.init();var db,gui,isDebug,preventDefault,sortTracklist,spinner_cover_opts,spinner_opts,win;gui=require("nw.gui"),win=gui.Window.get(),isDebug=!0,win.title=gui.App.manifest.name+" "+gui.App.manifest.version,win.focus(),win.show(),db=openDatabase("AtraciDB","1.0","",10485760),win.on("new-win-policy",function(a,b,c){return c.ignore()}),preventDefault=function(a){return a.preventDefault()},window.addEventListener("dragover",preventDefault,!1),window.addEventListener("drop",preventDefault,!1),window.addEventListener("dragstart",preventDefault,!1),spinner_opts={lines:10,length:8,width:3,radius:8,color:"#aaa",speed:2},spinner_cover_opts={lines:8,length:5,width:2,radius:6,color:"#fff",speed:2},$(function(){return window.l10n=new L10n,l10n.addEventListener("localizationchange",function(){var a;return a=$("[data-l10n-id]"),a.each(function(){return function(a,b){var c,d,e;return c=$(b),d=c.data("l10n-id"),e=c.data("l10n-params"),void 0!==c.attr("title")?c.attr("title",l10n.get(d,e)):c.text(l10n.get(d,e))}}(this))}),l10n.changeLang(),$("#tracklistSorter").change(function(){return PopulateTrackList(__currentTracklist,null,!0)}),Playlists.getAll(function(a){return populateSidebar(a)}),setTimeout(function(){return History.countTracks(function(){return $("#SideBar li.top").click()})},1),$("#Search input").focus(),$("#WindowButtons .Expand").click(function(){return $(this).hasClass("maximized")?($(this).removeClass("maximized"),win.unmaximize()):($(this).addClass("maximized"),win.maximize())}),$("#WindowButtons .Close").click(function(){return win.close()}),$("#WindowButtons .Minimize").click(function(){return win.minimize()}),!0}),sortTracklist=function(a){var b,c,d,e;switch(b=[],$("#tracklistSorter :selected").attr("value")){case"SongsName":b=a.sort(function(a,b){return a.title.localeCompare(b.title)});break;case"ArtistName":b=a.sort(function(a,b){return a.artist.localeCompare(b.artist)});break;case"Default":for(d=0,e=a.length;e>d;d++)c=a[d],b[c.id]=c}return b};var History;db.transaction(function(a){return a.executeSql("CREATE TABLE IF NOT EXISTS history (artist, title, cover_url_medium, cover_url_large, last_played)")}),History=function(){function a(){}return a.clear=function(a){return db.transaction(function(b){return b.executeSql("DROP TABLE history"),"function"==typeof a?a():void 0})},a.addTrack=function(a,b,c,d){var e;return e=Math.round((new Date).getTime()/1e3),db.transaction(function(f){return f.executeSql("CREATE TABLE IF NOT EXISTS history (artist, title, cover_url_medium, cover_url_large, last_played)"),f.executeSql("DELETE FROM history WHERE artist = ? and title = ?",[a,b]),f.executeSql("INSERT INTO history (artist, title, cover_url_medium, cover_url_large, last_played) VALUES (?, ?, ?, ?, ?)",[a,b,c,d,e])})},a.getTracks=function(a){var b;return b=[],db.transaction(function(c){return c.executeSql("SELECT * FROM history ORDER BY last_played DESC LIMIT 150",[],function(c,d){var e;for(e=0;e<d.rows.length;)b.push(d.rows.item(e)),e++;return"function"==typeof a?a(b):void 0})})},a.countTracks=function(a){return db.transaction(function(b){return b.executeSql("SELECT COUNT(*) AS cnt FROM history",[],function(b,c){return"function"==typeof a?a(c.rows.item(0).cnt):void 0})})},a}();var Playlists,__playlists;db.transaction(function(a){return a.executeSql("CREATE TABLE IF NOT EXISTS playlists (name, created)")}),__playlists=[],Playlists=function(){function a(){}return a.clear=function(a){return db.transaction(function(b){return b.executeSql("DROP TABLE playlist_tracks"),b.executeSql("DROP TABLE playlists"),"function"==typeof a?a():void 0})},a.addTrack=function(a,b,c,d,e){var f;return f=Math.round((new Date).getTime()/1e3),db.transaction(function(g){return g.executeSql("CREATE TABLE IF NOT EXISTS playlist_tracks (artist, title, cover_url_medium, cover_url_large, playlist, added)"),g.executeSql("DELETE FROM playlist_tracks WHERE artist = ? and title = ? and playlist = ?",[a,b,e]),g.executeSql("INSERT INTO playlist_tracks (artist, title, cover_url_medium, cover_url_large, playlist, added) VALUES (?, ?, ?, ?, ?, ?)",[a,b,c,d,e,f])})},a.removeTrack=function(a,b,c){return db.transaction(function(d){return d.executeSql("DELETE FROM playlist_tracks WHERE artist = ? and title = ? and playlist = ?",[a,b,c])})},a.create=function(a){var b;return b=Math.round((new Date).getTime()/1e3),db.transaction(function(c){return c.executeSql("DELETE FROM playlists WHERE name = ?",[a]),c.executeSql("INSERT INTO playlists (name, created) VALUES (?, ?)",[a,b])})},a["delete"]=function(a){return db.transaction(function(b){return b.executeSql("DELETE FROM playlists WHERE name = ?",[a]),b.executeSql("DELETE FROM playlist_tracks WHERE playlist = ?",[a])})},a.getAll=function(a){var b;return b=[],db.transaction(function(c){return c.executeSql("SELECT * FROM playlists ORDER BY created DESC",[],function(c,d){var e;for(e=0;e<d.rows.length;)b.push(d.rows.item(e)),e++;return __playlists=b,"function"==typeof a?a(b):void 0})})},a.getTracksForPlaylist=function(a,b){var c;return c=[],db.transaction(function(d){return d.executeSql("SELECT * FROM playlist_tracks WHERE playlist = ? ORDER BY added ASC",[a],function(a,d){var e;for(e=0;e<d.rows.length;)c.push(d.rows.item(e)),e++;return"function"==typeof b?b(c):void 0})})},a.rename=function(b,c){return db.transaction(function(a){return a.executeSql("UPDATE playlists SET name = ? WHERE name = ?",[c,b])}),a.getTracksForPlaylist(b,function(b){var d,e;for(d=0,e=[];d<b.length;)a.addTrack(b[d].artist,b[d].title,b[d].cover_url_medium,b[d].cover_url_large,c),e.push(d++);return e}),a["delete"](b)},a}();var TrackSource,request,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};request=require("request"),TrackSource=function(){function a(){}return a.search=function(a,b){var c,d;return d={itunes:[],lastfm:[],soundcloud:[]},c=function(){var a,c,e;return a=d.itunes.concat(d.lastfm,d.soundcloud),c=[],e=[],$.each(a,function(a,b){var d;return b&&b.artist&&b.title&&(d=b.artist.toLowerCase()+"___"+b.title.toLowerCase(),__indexOf.call(e,d)<0)?(c.push(b),e.push(d)):void 0}),"function"==typeof b?b(c):void 0},request({url:"http://itunes.apple.com/search?media=music&entity=song&limit=100&term="+encodeURIComponent(a),json:!0},function(a,b,e){var f;if(!a&&200===b.statusCode){f=[];try{$.each(e.results,function(a,b){return f.push({title:b.trackCensoredName,artist:b.artistName,cover_url_medium:b.artworkUrl60,cover_url_large:b.artworkUrl100})})}catch(g){}if(d.itunes=f,Object.keys(d).length>1)return c()}}),request({url:"http://ws.audioscrobbler.com/2.0/?method=track.search&api_key=c513f3a2a2dad1d1a07021e181df1b1f&format=json&track="+encodeURIComponent(a),json:!0},function(a,b,e){var f;if(!a&&200===b.statusCode){f=[];try{e.results.trackmatches.track.name&&(e.results.trackmatches.track=[e.results.trackmatches.track]),$.each(e.results.trackmatches.track,function(a,b){var c,d;return d=c="images/cover_default_large.png",b.image&&$.each(b.image,function(a,b){return"medium"===b.size&&""!==b["#text"]?d=b["#text"]:"large"===b.size&&""!==b["#text"]?c=b["#text"]:void 0}),f.push({title:b.name,artist:b.artist,cover_url_medium:d,cover_url_large:c})})}catch(g){}if(d.lastfm=f,Object.keys(d).length>1)return c()}}),request({url:"https://api.soundcloud.com/tracks.json?client_id=dead160b6295b98e4078ea51d07d4ed2&q="+encodeURIComponent(a),json:!0},function(a,b,e){var f;return f=[],$.each(e,function(a,b){var c,d;return b?(d=b.title.split(" - "),c=b.artwork_url,b.artwork_url||(c="images/cover_default_large.png"),f.push({title:d[0],artist:d[1],cover_url_medium:c,cover_url_large:c})):void 0}),d.soundcloud=f,Object.keys(d).length>1?c():void 0})},a.topTracks=function(a){return request({url:"http://itunes.apple.com/rss/topsongs/limit=100/explicit=true/json",json:!0},function(b,c,d){var e,f;return b||200!==c.statusCode?void 0:(e=[],f=[],$.each(d.feed.entry,function(a,b){var c;return c=b["im:artist"].label+"___"+b["im:name"].label,__indexOf.call(f,c)<0?(e.push({title:b["im:name"].label,artist:b["im:artist"].label,cover_url_medium:b["im:image"][1].label,cover_url_large:b["im:image"][2].label}),f.push(c)):void 0}),"function"==typeof a?a(e):void 0)})},a.history=function(a){return History.getTracks(function(b){return"function"==typeof a?a(b):void 0})},a.playlist=function(a,b){return Playlists.getTracksForPlaylist(a,function(a){return"function"==typeof b?b(a):void 0})},a}();var L10n;L10n=function(){function a(a){this.cachedStrings={},this.currentLang=a||"en",this.folder="l10n/",this.l10nFileSuffix=".ini",this.callbacks=[]}return a.prototype.fetchIniData=function(a){return this.cachedStrings[this.currentLang]?a():$.ajax({url:this.folder+this.currentLang+this.l10nFileSuffix}).done(function(b){return function(c){return b.cachedStrings[b.currentLang]=b.parseInI(c),a()}}(this))},a.prototype.parseInI=function(a){var b,c;return c={},b=a.split(/\r\n|\r|\n/),b.forEach(function(a){var b,d,e,f;return a=a.trim(),0!==a.length&&"#"!==a.charAt(0)&&";"!==a.charAt(0)?(f=/(\w+)\s*=\s*["]?(.*?)["]?$/,b=f.exec(a),d=b&&b[1],e=b&&b[2],d&&e?c[d]=e:void 0):void 0}),c},a.prototype.get=function(a,b){var c,d,e,f;for(f=this.cachedStrings[this.currentLang][a],d=/\{\{\s*(\w+)\s*\}\}/g,c=!1,e=function(){var a,d,e;return a=c&&c[0],d=c&&c[1],a&&d&&(e=b[d])?f=f.replace(a,e):void 0};c=d.exec(f);)e();if(f)return f;throw new Error("You are accessing non-existent l10nId : "+a)},a.prototype.addEventListener=function(a,b){return"localizationchange"===a?this.callbacks.push(b):void 0},a.prototype.removeEventListener=function(a,b){var c;return"localizationchange"===a&&(c=this.callbacks.indexOf(b),c>=0)?this.callbacks.splice(c,1):void 0},a.prototype.changeLang=function(a){return a&&(this.currentLang=a),this.fetchIniData(function(a){return function(){return a.callbacks.forEach(function(a){return a()})}}(this))},a}();var changeLang,debugMenu,l10nMenu,menu;menu=new gui.Menu({type:"menubar"}),l10nMenu=new gui.MenuItem({label:"Languages",submenu:new gui.Menu}),changeLang=function(a,b){return l10nMenu.submenu.items.forEach(function(a){return a.checked=!1}),a.checked=!0,window.l10n.changeLang(b)},[{label:"English",lang:"en","default":!0},{label:"繁體中文",lang:"zh-TW"},{label:"עברית",lang:"he-IL"},{label:"Esperanto",lang:"eo"},{label:"Italiano",lang:"it"},{label:"slovenščina",lang:"sl-SI"},{label:"Español",lang:"es-419"},{label:"日本語",lang:"ja"},{label:"Deutsch",lang:"de"},{label:"Afrikaans",lang:"af-ZA"},{label:"Bosanski",lang:"bs-BA"},{label:"Hrvatski",lang:"hr-HR"},{label:"Serbian",lang:"sr"},{label:"Français",lang:"fr"},{label:"Polski",lang:"pl-PL"},{label:"Português",lang:"pt-BR"}].forEach(function(a){var b,c,d;return b=a.label,c=a.lang,d=new gui.MenuItem({label:b,type:"checkbox",click:function(){return changeLang(this,c)}}),a["default"]&&(d.checked=!0),l10nMenu.submenu.append(d)}),menu.append(l10nMenu),isDebug&&(debugMenu=new gui.MenuItem({label:"Tools",submenu:new gui.Menu}),debugMenu.submenu.append(new gui.MenuItem({label:"Developer Tools",click:function(){return win.showDevTools()}})),debugMenu.submenu.append(new gui.MenuItem({label:"Reload ignoring cache",click:function(){return win.reloadIgnoringCache()}})),debugMenu.submenu.append(new gui.MenuItem({label:"Reset database",click:function(){return Playlists.clear(function(){return History.clear(function(){return win.reloadIgnoringCache()})})}})),menu.append(debugMenu)),win.menu=menu;var PlayNext,PlayPrevious,PlayTrack,itag_priorities,playerContainer,request,spinner_cover,videoContainer,video_error_codes,ytdl,__LastSelectedTrack,__currentTrack,__playerTracklist;request=require("request"),ytdl=require("ytdl"),playerContainer=$("#PlayerContainer"),videoContainer=$("#video-container"),itag_priorities=[85,84,43,82],video_error_codes={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},__LastSelectedTrack=null,__currentTrack={},__playerTracklist=[],spinner_cover=null,PlayNext=function(a,b){return $.each(__playerTracklist,function(c,d){var e;return d.artist===a&&d.title===b?($("#ContentWrapper .track-container").removeClass("playing"),c<__playerTracklist.length-1?(e=__playerTracklist[c+1],$("#ContentWrapper .track-container").eq(c+1).addClass("playing")):(e=__playerTracklist[0],$("#ContentWrapper .track-container").eq(0).addClass("playing")),PlayTrack(e.artist,e.title,e.cover_url_medium,e.cover_url_large)):void 0})},PlayPrevious=function(a,b){return $.each(__playerTracklist,function(c,d){var e;return d.artist===a&&d.title===b?($("#ContentWrapper .track-container").removeClass("playing"),0===c?(e=__playerTracklist[0],$("#ContentWrapper .track-container").eq(0).addClass("playing")):(e=__playerTracklist[c-1],$("#ContentWrapper .track-container").eq(c-1).addClass("playing")),PlayTrack(e.artist,e.title,e.cover_url_medium,e.cover_url_large)):void 0})},PlayTrack=function(a,b,c,d){var e;return userTracking.event("Player","Play",a+" - "+b).send(),__currentTrack={artist:a,title:b},__playerTracklist=__currentTracklist,e=Math.random(),__LastSelectedTrack=e,videojs("video_player").pause().currentTime(0),History.addTrack(a,b,c,d),spinner_cover&&(playerContainer.find("#cover #loading-overlay").hide(),spinner_cover.stop()),playerContainer.find(".info .video-info").html("► Loading..."),playerContainer.find(".info .track-info .artist,#PlayerContainer .title").empty(),playerContainer.find(".duration, .current-time").text("0:00"),playerContainer.find(".cover").css({"background-image":"url("+d+")"}),playerContainer.find(".cover #loading-overlay").show(),spinner_cover=new Spinner(spinner_cover_opts).spin(playerContainer.find(".cover")[0]),playerContainer.find(".progress-current").css({width:"0px"}),playerContainer.find(".info .track-info .artist").html(a),playerContainer.find(".info .track-info .title").html(b),request({url:"http://gdata.youtube.com/feeds/api/videos?alt=json&max-results=1&q="+encodeURIComponent(a+" - "+b),json:!0},function(a,b,c){return c.feed.entry?(playerContainer.find("#info #video-info").html("► "+c.feed.entry[0].title.$t+" ("+c.feed.entry[0].author[0].name.$t+")"),ytdl.getInfo(c.feed.entry[0].link[0].href,{downloadURL:!0},function(a,b){var c;return a?console.log(a):(c=[],$.each(b.formats,function(a,b){return c[b.itag]=b.url}),$.each(itag_priorities,function(a,b){return c[b]?(e===__LastSelectedTrack&&(videojs("video_player").src(c[b]).play(),userTracking.event("Playback Info","itag",b).send()),!1):void 0}))})):PlayNext(__currentTrack.artist,__currentTrack.title)})},videojs("video_player"),$(document).keydown(function(a){return 32===a.keyCode&&"INPUT"!==a.target.tagName?(videojs("video_player").paused()?videojs("video_player").play():videojs("video_player").pause(),!1):(37===a.keyCode&&"INPUT"!==a.target.tagName&&PlayPrevious(__currentTrack.artist,__currentTrack.title),39===a.keyCode&&"INPUT"!==a.target.tagName?PlayNext(__currentTrack.artist,__currentTrack.title):void 0)}),playerContainer.find(".info .track-info .action .play, .info .track-info .action .pause").click(function(){return $(this).hasClass("play")?videojs("video_player").play():videojs("video_player").pause()}),videojs("video_player").ready(function(){return this.on("loadedmetadata",function(){return playerContainer.find(".duration").text(moment(1e3*this.duration()).format("m:ss")),videojs("video_player").play()}),this.on("timeupdate",function(){return playerContainer.find(".progress-current").css({width:this.currentTime()/this.duration()*100+"%"}),playerContainer.find(".current-time").text(moment(1e3*this.currentTime()).format("m:ss"))}),this.on("ended",function(){var a;return playerContainer.find(".repeat").closest(".action").hasClass("active")?(videojs("video_player").currentTime(0),videojs("video_player").play()):playerContainer.find(".random").closest(".action").hasClass("active")?(a=__playerTracklist[Math.floor(Math.random()*__playerTracklist.length)],PlayTrack(a.artist,a.title,a.cover_url_medium,a.cover_url_large)):PlayNext(__currentTrack.artist,__currentTrack.title)}),this.on("play",function(){return spinner_cover&&(playerContainer.find(".cover #LoadingOverlay").hide(),spinner_cover.stop()),playerContainer.find(".info .track-info .action i.play").hide(),playerContainer.find(".info .track-info .action i.pause").show()}),this.on("pause",function(){return playerContainer.find(".info .track-info .action i.pause").hide(),playerContainer.find(".info .track-info .action i.play").show()}),this.on("error",function(a){var b;return b=a.target.error?a.target.error.code:a.code,userTracking.event("Playback Error",video_error_codes[b],__currentTrack.artist+" - "+__currentTrack.title).send(),alertify.alert("Playback Error ("+video_error_codes[b]+")"),PlayNext(__currentTrack.artist,__currentTrack.title)})}),playerContainer.find(".volume-bg").ready(function(){return playerContainer.find(".controls .volume-icon .action i.fa-volume-down").hide(),playerContainer.find(".controls .volume-icon #action i.fa-volume-off").hide()}),playerContainer.find(".progress-bg").on("click",function(a){var b;return b=(a.pageX-$(this).offset().left)/$(this).width(),videojs("video_player").currentTime(b*videojs("video_player").duration()),playerContainer.find(".progress-current").animate({width:100*b+"%"})}),playerContainer.find(".volume-bg").on("click",function(a){var b;return b=(a.pageX-$(this).offset().left)/$(this).width(),playerContainer.attr("data-volume",b),playerContainer.find(".volume-icon").attr("data-ismuted",0),playerContainer.find(".volume-icon").find("i").removeClass("fa-volume-off").addClass("fa fa-volume-up"),videojs("video_player").volume(b),playerContainer.find(".volume-current").animate({width:100*b+"%"})}),playerContainer.find(".track-info .backward").on("click",function(){return PlayPrevious(__currentTrack.artist,__currentTrack.title)}),playerContainer.find(".track-info .forward").on("click",function(){return PlayNext(__currentTrack.artist,__currentTrack.title)}),playerContainer.find(".track-info .repeat").on("click",function(){return $(this).closest(".action").toggleClass("active")}),playerContainer.find(".track-info .random").on("click",function(){return $(this).closest(".action").toggleClass("active")}),playerContainer.find(".volume-icon").on("click",function(){return 1===+$(this).attr("data-ismuted")?($(this).attr("data-ismuted",0),$(this).find("i").removeClass("fa-volume-off").addClass("fa fa-volume-up"),videojs("video_player").volume(playerContainer.attr("data-volume"))):($(this).attr("data-ismuted",1),$(this).find("i").removeClass("fa-volume-up").addClass("fa fa-volume-off"),videojs("video_player").volume(0))}),videoContainer.find(".ExpandButton").on("click",function(){return $("#video-container").toggleClass("expanded")}),videoContainer.find("#video_player").on("dblclick",function(){return $("#video-container").toggleClass("expanded")}),$("#PlayerContainer .progress-bg").on("mousemove",function(a){var b,c,d,e,f;return 0!==videojs("video_player").currentTime()?(d=(a.pageX-$(this).offset().left)/$(this).width(),f=d*videojs("video_player").duration(),c=parseInt(f/60)%60,e=parseInt(f%60),f=10>e?c+":0"+e:c+":"+e,$("#PlayerContainer .mouse-time").show(),$("#PlayerContainer .mouse-time").text(f),b=a.pageX-135,$("#PlayerContainer .mouse-time").css({"margin-left":b+"px"})):void 0}),$("#PlayerContainer .progress-bg").on("mouseout",function(){return $("#PlayerContainer .mouse-time").hide()});var doSearch;doSearch=function(a,b,c){var d;return userTracking.event("Search","organic",a).send(),$("#sidebar-container li.active").removeClass("active"),$("#tracklist-container").empty(),d=new Spinner(spinner_opts).spin($("#tracklist-container")[0]),TrackSource.search(a,function(a){return b?c(a):(d.stop(),PopulateTrackList(a))})},$(function(){return $("#Search input").autocomplete({delay:100,messages:{noResults:"",results:function(){}},select:function(a,b){return doSearch(b.item.value)},source:function(a,b){var c;return c=a.term,c?$.getJSON("http://www.last.fm/search/autocomplete?q="+c,function(a){var c,d,e;return d=null!=a&&null!=(e=a.response)?e.docs:void 0,c=[],d&&(d.forEach(function(a){var b,d;if(a.track)b="Track",d=a.artist+" "+a.track;else if(a.album)b="Album",d=a.artist+" "+a.album;else{if(!a.artist)return;b="Artist",d=a.artist}return c.push({type:b,weight:a.weight,label:d,value:d})}),c.sort(function(a,b){return a.weight<b.weight})),b(c)}):b([])}}).data("ui-autocomplete")._renderItem=function(a,b){var c,d,e,f;switch(f="",b.type){case"Track":f="fa-music";break;case"Album":f="fa-folder-open-o";break;case"Artist":f="fa-group"}return d=$("<span>"),d.addClass("fa fa-fw "+f),e=$("<span>"),e.text(b.label),c=$("<a>"),c.append(d),c.append(e),$("<li>").data("item.autocomplete",b).append(c).appendTo(a)},$("#Search input").keypress(function(a){var b;return b=$(this).val(),13===a.which&&""!==$(this).val()?doSearch(b):void 0}),$("#ContentWrapper").on("click",".track-container",function(){return videojs("video_player").paused()!==!0&&0===videojs("video_player").currentTime()&&(PlayTrack($(this).find(".artist").text(),$(this).find(".title").text(),$(this).find(".cover").attr("data-cover_url_medium"),$(this).find(".cover").attr("data-cover_url_large")),$(this).siblings(".playing").removeClass("playing"),$(this).addClass("playing")),$(this).find(".artist").text()!==__currentTrack.artist||$(this).find(".title").text()!==__currentTrack.title?(PlayTrack($(this).find(".artist").text(),$(this).find(".title").text(),$(this).find(".cover").attr("data-cover_url_medium"),$(this).find(".cover").attr("data-cover_url_large")),$(this).siblings(".playing").removeClass("playing"),$(this).addClass("playing")):videojs("video_player").paused()?videojs("video_player").play():videojs("video_player").pause()})});var loadFeaturedArtistPage,populateSidebar;populateSidebar=function(a){var b,c,d,e;for(b=$("#SideBar ul li.active").text(),$("#SideBar ul").empty(),$("#SideBar ul").append('<li class="top"><i class="fa fa-music"></i><span data-l10n-id="top_track">Top Tracks</span></li>'),$("#SideBar ul").append('<li class="featured"><i class="fa fa-users"></i><span data-l10n-id="featured_artist">Featured Artist</span></li>'),$("#SideBar ul").append('<li class="sep"><hr></li>'),$("#SideBar ul").append('<li class="history"><i class="fa fa-history"></i><span data-l10n-id="history">History</span></li>'),$("#SideBar ul").append('<li class="sep"><hr></li>'),$("#SideBar ul").append('<li class="new"><i class="fa fa-plus-square"></i><span data-l10n-id="new_playlist">New playlist</span></li>'),d=0,e=a.length;e>d;d++)c=a[d],$("#SideBar ul").append('<li class="playlist" data-name="'+c.name+'">'+c.name+"</li>");return $("#SideBar ul li").filter(function(){return $(this).text()===b}).addClass("active")},$(function(){return $("#SideBar").on("click","li.history, li.playlist, li.top, li.featured",function(){return $(this).siblings(".active").removeClass("active"),$(this).addClass("active")}),$("#SideBar").on("click","li",function(){var a;return $(this).hasClass("top")?($("#ContentWrapper").empty(),a=new Spinner(spinner_opts).spin($("#ContentWrapper")[0]),TrackSource.topTracks(function(b){return a.stop(),PopulateTrackList(b)})):$(this).hasClass("history")?TrackSource.history(function(a){return PopulateTrackList(a)}):$(this).hasClass("playlist")?TrackSource.playlist($(this).text(),function(a){return PopulateTrackList(a)}):$(this).hasClass("featured")?loadFeaturedArtistPage():void 0}),$("#SideBar ul").on("click","li.new",function(){return alertify.prompt(l10n.get("create_playlist_popup"),function(a,b){if(a){if(!b)return;return Playlists.create(b),Playlists.getAll(function(a){return populateSidebar(a)}),userTracking.event("Playlist","Create",b).send()}})}),$("#SideBar ul").on("contextmenu","li.playlist",function(a){var b,c;return c=$(this).text(),a.stopPropagation(),b=new gui.Menu,b.append(new gui.MenuItem({label:"Delete "+$(this).text(),click:function(){return alertify.confirm(l10n.get("delete_playlist_popup"),function(a){return a?($("#SideBar [data-name="+c+"]").remove(),Playlists["delete"](c),Playlists.getAll(function(a){return populateSidebar(a)}),userTracking.event("Playlist","Delete",c).send()):void 0})}})),b.append(new gui.MenuItem({label:"Rename "+$(this).text(),click:function(){return alertify.prompt(l10n.get("rename_playlist_popup"),function(a,b){return a&&b?(Playlists.rename(c,b),Playlists.getAll(function(a){return populateSidebar(a)}),userTracking.event("Playlist","Rename",b).send()):void 0},c)}})),b.popup(a.clientX,a.clientY),!1})}),loadFeaturedArtistPage=function(){return $.getJSON("http://getatraci.net/featured.json",function(a){return doSearch(a.value,!0,function(b){return PopulateTrackList(b,a)})}),!0};var dummyMethod,getOperatingSystem,getTrackingId,os,resolution,ua,userTracking;os=require("os"),getTrackingId=function(){var a,b;return a=Settings.get("trackingId"),!("undefined"!=typeof a&&null!=a&&""!==a||(b=require("node-uuid"),Settings.set("trackingId",b.v4()),a=Settings.get("trackingId"),"undefined"!=typeof a&&null!=a&&""!==a||(Settings.set("trackingId",b.v1()),a=Settings.get("trackingId"),"undefined"!=typeof a&&null!=a&&""!==a||!(a=null)))),a},ua=require("universal-analytics"),null==getTrackingId()?(dummyMethod=function(){return{send:function(){}}},userTracking=window.userTracking={event:dummyMethod,pageview:dummyMethod,timing:dummyMethod,exception:dummyMethod,transaction:dummyMethod}):userTracking=window.userTracking=ua("UA-49098639-1",getTrackingId()),getOperatingSystem=function(){var a;return a=os.platform(),"win32"===a||"win64"===a?"windows":"darwin"===a?"mac":"linux"===a?"linux":null},userTracking.event("Device Stats","Version",gui.App.manifest.version).send(),userTracking.event("Device Stats","Type",getOperatingSystem()).send(),userTracking.event("Device Stats","Operating System",os.type()+" "+os.release()).send(),userTracking.event("Device Stats","CPU",os.cpus()[0].model+" @ "+(os.cpus()[0].speed/1e3).toFixed(1)+"GHz x "+os.cpus().length).send(),userTracking.event("Device Stats","RAM",Math.round(os.totalmem()/1024/1024/1024)+"GB").send(),userTracking.event("Device Stats","Uptime",Math.round(os.uptime()/60/60)+"hs").send(),"number"==typeof screen.width&&"number"==typeof screen.height&&(resolution=screen.width.toString()+"x"+screen.height.toString(),"number"==typeof screen.pixelDepth&&(resolution+="@"+screen.pixelDepth.toString()),"number"==typeof window.devicePixelRatio&&(resolution+="#"+window.devicePixelRatio.toString()),userTracking.event("Device Stats","Resolution",resolution).send()),userTracking.event("Device Stats","Language",navigator.language.toLowerCase()).send(),userTracking.pageview("/").send(),setInterval(function(){return userTracking.event("_KeepAlive","Pulse").send()},6e5);var PopulateTrackList,calculateDivsInRow,currentContextTrack,track_menu,__artistObject,__currentTracklist;track_menu=new gui.Menu,track_menu.append(new gui.MenuItem({label:"Add to Favorites"})),currentContextTrack=null,__currentTracklist=[],__artistObject={},PopulateTrackList=function(a,b,c){var d;if(a.length>0&&!c)for(d in a)a[d].id=d;return a=sortTracklist(a),$("#ContentWrapper").empty().scrollTop(),b&&(__artistObject=b),__artistObject&&$("#SideBar .active").hasClass("featured")&&$("#tmpl-artistPage").tmpl(__artistObject).prependTo("#ContentWrapper"),a.length>0?($("#tmpl-tracklist").tmpl(a).appendTo("#ContentWrapper"),__currentTracklist=a,calculateDivsInRow()):$("#tmpl-tracklist-error").tmpl({message:"No tracks"}).appendTo("#ContentWrapper")},$(function(){return $("#ContentWrapper").on("contextmenu",".track-container",function(a){var b,c,d;return d=$(this),a.stopPropagation(),b=new gui.Menu,$.each(__playlists,function(a,c){return b.append(new gui.MenuItem({label:"Add to "+c.name,click:function(){return Playlists.addTrack(d.find(".artist").text(),d.find(".title").text(),d.find(".cover").attr("data-cover_url_medium"),d.find(".cover").attr("data-cover_url_large"),c.name),userTracking.event("Playlist","Add Track to Playlist",c.name).send()}}))}),$("#SideBar li.active").hasClass("playlist")&&(b.append(new gui.MenuItem({type:"separator"})),c=$("#SideBar li.active").text(),b.append(new gui.MenuItem({label:"Remove from "+c,click:function(){return Playlists.removeTrack(d.find(".artist").text(),d.find(".title").text(),c),d.remove(),userTracking.event("Playlist","Remove Track to Playlist",c).send()}}))),b.popup(a.clientX,a.clientY),!1}),$(".trackListToolbar i").click(function(){return $(".trackListToolbar i").removeClass("active"),$(this).addClass("active"),$(this).hasClass("fa-th")?$("#ContentWrapper").removeClass("smallRows"):$("#ContentWrapper").addClass("smallRows")}),track_menu.items[0].click=function(){return Playlists.addTrack(currentContextTrack.find(".artist").text(),currentContextTrack.find(".title").text(),currentContextTrack.find(".cover").attr("data-cover_url_medium"),currentContextTrack.find(".cover").attr("data-cover_url_large"),"Favorites")}}),calculateDivsInRow=function(){var a,b,c;for($(".ghost").remove(),b=0,$("#ContentWrapper .track-container").each(function(){if($(this).prev().length>0){if($(this).position().top!==$(this).prev().position().top)return!1;b++}else b++}),a=$("#ContentWrapper .track-container").length%b,0===a&&(a=b),c=b-a;c>0;)$("#ContentWrapper").append($("<div/>").addClass("track-container ghost")),c--},window.onresize=function(){var a;clearTimeout(a),a=setTimeout(calculateDivsInRow,100)};var request,versionCompare;request=require("request"),request({url:Settings.get("updateUrl"),json:!0},function(a,b,c){return!a&&200===b.statusCode&&(c.updateUrl&&c.downloadUrl&&Settings.set("updateUrl",c.updateUrl),c[getOperatingSystem()]&&1===versionCompare(c[getOperatingSystem()].version,gui.App.manifest.version))?alertify.confirm("A new version of Atraci is available ("+c[getOperatingSystem()].version+") !\n\nBy pressing OK, you will be redirected to the website where you can download the latest version.\n\nWhat's New:\n"+c[getOperatingSystem()].description,function(a){return a?gui.Shell.openExternal(c.downloadUrl):void 0}):void 0}),versionCompare=function(a,b){var c,d,e,f;if(typeof a+typeof b!="stringstring")return!1;for(c=a.split("."),d=b.split("."),e=0,f=Math.max(c.length,d.length);f>e;){if(c[e]&&!d[e]&&parseInt(c[e])>0||parseInt(c[e])>parseInt(d[e]))return 1;if(d[e]&&!c[e]&&parseInt(d[e])>0||parseInt(c[e])<parseInt(d[e]))return-1;e++}return 0};